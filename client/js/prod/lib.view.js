window.SLB&&SLB.attach&&function(t){var e={assets:{},component_defaults:[],loading:[],cache:{},component_temps:{},options:{},_init:function(){this._super(),this.init_refs(),this.init_components()},init_refs:function(){var t,e,i;for(i in this)if(i=this[i],this.is_component(i)&&!this.util.is_empty(i.prototype._refs))for(t in i.prototype._refs)e=i.prototype._refs[t],this.util.is_string(e)&&e in this&&(e=i.prototype._refs[t]=this[e]),this.util.is_class(e)||delete i.prototype_refs[t]},init_components:function(){this.component_defaults=[this.Viewer]},init:function(e){var i=this;t.when.apply(t,this.loading).always(function(){t.extend(!0,i.options,e),t(window).on("popstate",function(t){var e=t.originalEvent.state;if(i.util.in_obj(e,["item","viewer"]))return i.get_viewer(e.viewer).history_handle(t),t.preventDefault()}),i.init_items()})},can_make_default_component:function(e){return -1!==t.inArray(e,this.component_defaults)},is_component:function(t){return this.util.is_class(t,this.Component)},get_components:function(t){var e={};if(this.is_component(t)){var i=t.prototype._slug+"s";i in this.cache||(this.cache[i]={}),e=this.cache[i]}return e},get_component:function(t,e){var i=null;if(!this.util.is_func(t))return i;this.util.is_string(e)||(e=null);var s=this.get_components(t);if(this.util.is_obj(s)){var n=this.util.is_string(e)?e:this.util.add_prefix("default");n in s&&(i=s[n])}return this.util.is_empty(i)&&(this.util.is_string(e)||this.can_make_default_component(t))&&(i=this.add_component(t,e)),i},add_component:function(e,i,s){if(!this.util.is_func(e)||this.util.is_empty(i)&&!this.can_make_default_component(e))return!1;var n=null;this.util.is_empty(i)&&(i=this.util.add_prefix("default")),this.util.is_obj(s)||(s={});var r="component"!==e.prototype._slug?"add_"+e.prototype._slug:null;if(n=!this.util.is_empty(r)&&r in this&&this.util.is_func(this[r])?this[r](i,s):new e(i,s),this.util.is_type(n,e)){var u=this.get_components(e);switch(t.type(u)){case"object":u[i]=n;break;case"array":u.push(n)}}else n=null;return n},add_component_temp:function(t){var e=null;return this.is_component(t)&&(e=new t(""),this.component_temps[e._slug]=e),e},get_component_temp:function(t){return this.has_component_temp(t)?this.component_temps[t.prototype._slug]:this.add_component_temp(t)},has_component_temp:function(t){return!!this.is_component(t)&&t.prototype._slug in this.component_temps},get_options:function(t){var e={};if(this.util.is_string(t)&&(t=[t]),!this.util.is_array(t))return e;for(var i=0;i<t.length;i++)t[i]in this.options&&(e[t[i]]=this.options[t[i]]);return e},get_option:function(t,e){var i=this.get_options(t);return this.util.is_obj(i)&&t in i?i[t]:this.util.is_set(e)?e:null},add_viewer:function(t,e){var i=new this.Viewer(t,e);return this.get_viewers()[i.get_id()]=i,i},get_viewers:function(){return this.get_components(this.Viewer)},has_viewer:function(t){return!!(this.util.is_string(t)&&t in this.get_viewers())},get_viewer:function(t){return this.has_viewer(t)||(t=this.util.add_prefix("default"),this.has_viewer(t)||(t=(t=this.add_viewer(t)).get_id())),this.get_viewers()[t]},init_items:function(){var e=this,i=function(){var t=e.show_item(this);return e.util.is_bool(t)||(t=!0),!t},s=this.util.format('a[href][%s="%s"]',this.util.get_attribute("active"),1);t(document).on("click",s,null,i)},get_items:function(){return this.get_components(this.Content_Item)},get_item:function(e){if(this.util.is_type(e,this.Content_Item))return e;var i=null;if(this.util.in_obj(e,"nodeType")){var s=this.get_component_temp(this.Content_Item).get_data_key();i=t(e).data(s)}else if(this.util.is_string(e,!1)){var n=this.get_items();e in n&&(i=n[e])}return this.util.is_instance(i,this.Content_Item)||(i=this.add_item(e)),i},add_item:function(t){return new this.Content_Item(t)},show_item:function(t){return this.get_item(t).show()},save_item:function(t){return this.util.is_instance(t,this.Content_Item)&&(this.get_items()[t.get_id()]=t),t},get_content_handlers:function(){return this.get_components(this.Content_Handler)},get_content_handler:function(t){var e=this.util.is_instance(t,this.Content_Item)?t.get_attribute("type",""):t.toString(),i=this.get_content_handlers();return e in i?i[e]:null},extend_content_handler:function(t,e){var i=null;return this.util.is_string(t)&&this.util.is_obj(e)?(null===(i=this.get_content_handler(t))?this.get_content_handlers()[t]=i=new this.Content_Handler(t,e):i.set_attributes(e),this.util.in_obj(e,"styles")&&this.load_styles(e.styles),i):i},add_group:function(t,e){return t=new this.Group(t,e),this.get_groups()[t.get_id()]=t,t},get_groups:function(){return this.get_components(this.Group)},get_group:function(t){return this.has_group(t)?this.get_groups()[t]:this.add_group(t)},has_group:function(t){return this.util.is_string(t)&&t in this.get_groups()},extend_theme:function(e,i){if(!this.util.is_string(e))return!1;var s=t.Deferred();this.loading.push(s);var n=this.get_theme_model(e);return this.util.is_empty(n)&&(n=this.save_theme_model({parent:null,id:e})),this.util.is_obj(i)&&("id"in i&&delete i.id,t.extend(n,i)),this.util.in_obj(i,"styles")&&this.load_styles(i.styles),this.util.is_obj(n.parent)||(n.parent=this.get_theme_model(n.parent)),s.resolve(),n},get_theme_models:function(){return this.Theme.prototype._models},get_theme_model:function(t){var e=this.get_theme_models();return this.util.in_obj(e,t)?e[t]:{}},save_theme_model:function(t){return this.util.in_obj(t,"id")&&this.util.is_string(t.id)&&(this.get_theme_models()[t.id]=t),t},extend_template_tag_handler:function(t,e){if(!this.util.is_string(t)||!this.util.is_obj(e))return!1;var i,s=this.get_template_tag_handlers();return this.util.in_obj(s,t)?(i=s[t]).set_attributes(e):s[(i=new this.Template_Tag_Handler(t,e)).get_id()]=i,this.util.in_obj(e,"styles")&&this.load_styles(e.styles),this.util.in_obj(e,"_hooks")&&e._hooks.call(i),i},get_template_tag_handlers:function(){return this.Template_Tag.prototype.handlers},get_template_tag_handler:function(t){var e=this.get_template_tag_handlers();return this.util.in_obj(e,t)?e[t]:null},load_styles:function(e){if(this.util.is_array(e)){for(var i,s=[],n=0;n<e.length;n++)i=e[n],this.util.in_obj(i,"uri")&&this.util.is_string(i.uri)&&s.push('<link rel="stylesheet" type="text/css" href="'+i.uri+'" />');t("head").append(s.join(""))}}},i={_slug:"component",_ns:null,_refs:{},_reciprocal:!1,_dom:null,_attributes:!1,_attr_default:{},_attr_default_parsed:!1,_attr_init:null,_attr_map:{},_events:{},_status:null,_id:"",_c:function(t,e){this._set_id(t),this.util.is_obj(e)&&(this._attr_init=e),this._hooks()},_set_parent:function(){this._super(e)},_hooks:function(){},_set_id:function(t){return this.util.is_empty(this._id)&&(this._id=this.util.is_string(t)?t:this.util.guid()),this._id},get_id:function(t){var e=this._id;return this.util.is_bool(t)&&t&&(e=this.add_ns(e)),e},get_ns:function(){return null===this._ns&&(this._ns=this.util.add_prefix(this._slug)),this._ns},add_ns:function(t){return this.util.is_string(t)?this.get_ns()+"_"+t:""},get_status:function(t,e){var i=!1;return this.util.in_obj(this._status,t)&&(i=e?this._status[t]:!!this._status[t]),i},set_status:function(t,e){return this.util.is_string(t)?(this.util.is_set(e)||(e=!0),this.util.is_obj(this._status,!1)||(this._status={}),this._status[t]=e):this.util.is_set(e)||(e=!1),e},get_controller:function(){return this.get_parent()},has_reference:function(t){return!!(this.util.is_string(t)&&t in this&&t in this.get_references())},get_references:function(){return this._refs},get_reference:function(t){return this.has_reference(t)?this._refs[t]:null},get_component:function(e,i){var s=null;if(!this.has_reference(e))return s;i=t.extend({},{check_attr:!0,get_default:!1},i);var n=this.get_reference(e);return this.util.is_type(this[e],n)?this[e]:(s=this[e]=null,i.check_attr&&(s=this.get_attribute(e),this.util.is_empty(s)||(s=this.set_component(e,s))),this.util.is_empty(s)&&i.get_default&&(s=this.get_controller().get_component(n)),s)},set_component:function(t,e,i){if(!this.has_reference(t))return null;if(this.util.is_empty(e))e=null;else{var s=this.get_reference(t);this.util.is_string(e,!1)&&(e=this.get_controller().get_component(s,e)),(!this.util.is_type(e,s)||this.util.is_func(i)&&!i.call(this,e))&&(e=null)}return this[t]=e,this[t]},clear_component:function(t){this.set_component(t,null)},init_attributes:function(e){if(this.util.is_bool(e)||(e=!1),e||!this.util.is_obj(this._attributes)){var i=this._attributes={};t.extend(i,this.init_default_attributes()),this.util.is_obj(this._attr_init)&&t.extend(i,this._attr_init),t.extend(i,this.get_dom_attributes())}},init_default_attributes:function(){if(!this._attr_default_parsed&&this.util.is_obj(this._attr_map)){var e=this.get_controller().get_options(this.util.obj_keys(this._attr_map));if(this.util.is_obj(e)){for(var i in this._attr_map)i in e&&null!==this._attr_map[i]&&(e[this._attr_map[i]]=e[i],delete e[i]);t.extend(!0,this._attr_default,e)}this._attr_default_parsed=!0}return this._attr_default},get_dom_attributes:function(){var e={},i=this.dom_get(null,{init:!1});if(i.length>0){var s=t(i).get(0).attributes;if(this.util.is_obj(s)){var n,r=this.util.get_attribute();t.each(s,function(t,i){if(-1===i.name.indexOf(r))return!0;e[n=i.name.substr(r.length+1)]=i.value})}}return e},get_attributes:function(){return this.init_attributes(),this._attributes},get_attribute:function(e,i,s){if(this.util.is_set(i)||(i=null),!this.util.is_string(e))return i;this.util.is_bool(s)||(s=!0);var n=this.has_attribute(e)?this.get_attributes()[e]:i;return!s||n===i||null===i||this.util.is_type(n,t.type(i),!1)||(this.util.is_scalar(i,!1)&&this.util.is_scalar(n,!1)?this.util.is_string(i,!1)?n=n.toString():this.util.is_num(i,!1)&&!this.util.is_num(n,!1)?(n=this.util.is_int(i,!1)?parseInt(n):parseFloat(n),this.util.is_num(n,!1)||(n=i)):n=this.util.is_bool(i,!1)?this.util.is_string(n)||this.util.is_num(n):i:n=i),n},call_attribute:function(t,e){return t=this.get_attribute(t),this.util.is_func(t)&&(e=Array.prototype.slice.call(arguments,1),t=t.apply(this,e)),t},has_attribute:function(t){return this.util.is_string(t)&&t in this.get_attributes()},set_attributes:function(e,i){this.util.is_bool(i)||(i=!1),this.init_attributes(i),this.util.is_obj(e)&&t.extend(this._attributes,e)},set_attribute:function(t,e){return this.util.is_string(t)&&this.util.is_set(e)&&(this.get_attributes()[t]=e),e},dom_get_selector:function(t){return this.util.is_string(t)?"."+this.add_ns(t):""},dom_get_attribute:function(){return this.util.get_attribute(this._slug)},dom_set:function(e){return(e=t(e)).data(this.get_data_key(),this),this._reciprocal&&(this._dom=e),e},dom_get:function(e,i){var s={init:!0,put:!1};(i=this.util.is_obj(i)?t.extend({},s,i):s).init&&!this.get_status("dom_init")&&(this.set_status("dom_init"),this.dom_init());var n=this._dom;if(n&&this.util.is_string(e)){var r=t(n).find(this.dom_get_selector(e));r.length?n=r:(!0===i.put||this.util.is_obj(i.put))&&(n=this.dom_put(e,i.put))}return t(n)},dom_init:function(){},dom_put:function(e,i){var s=null;if(!this.dom_has()||!this.util.is_string(e))return t(s);var n=["tag","content","success"],r={tag:"div",content:"",class:this.add_ns(e)};!this.util.is_empty(i)&&(this.util.is_type(i,jQuery,!1)||this.util.is_string(i,!1)?r.content=i:this.util.is_obj(i,!1)&&t.extend(r,i));for(var u=t.extend({},r),o=0;o<n.length;o++)delete u[n[o]];var h=this.dom_get();return!(s=t(this.dom_get_selector(e),h)).length&&(s=t(this.util.format("<%s />",r.tag),u).appendTo(h)).length&&this.util.is_method(r,"success")&&r.success.call(s,s),t(s).append(r.content),t(s)},dom_has:function(){return!!this.dom_get().length},get_data_key:function(){return this.get_ns()},on:function(e,i,s){if(!this.util.is_string(e)||!this.util.is_func(i)){var n=this,r=Array.prototype.slice.call(arguments,1);return this.util.is_array(e)?t.each(e,function(t,e){n.on.apply(n,[e].concat(r))}):this.util.is_obj(e)&&t.each(e,function(t,e){n.on.apply(n,[t,e].concat(r))}),this}this.util.is_obj(s,!1)||(s={}),s=t.extend({},{clear:!1},s),this.util.is_obj(this._events,!1)||(this._events={});var u=this._events;return e in u&&this.util.is_obj(u[e],!1)&&!s.clear||(u[e]=[]),u[e].push(i),this},trigger:function(e,i){var s=t.Deferred(),n=[],r=this;if(this.util.is_array(e))return t.each(e,function(t,e){n.push(r.trigger(e,i))}),t.when.apply(r,n).done(function(){s.resolve()}),s.promise();if(!this.util.is_string(e)||!(e in this._events))return s.resolve(),s.promise();var u={type:e,data:null};return this.util.is_set(i)&&(u.data=i),t.each(this._events[e],function(t,e){n.push(e.call(r,u,r))}),t.when.apply(this,n).done(function(){s.resolve()}),s.promise()}};e.Component=i=SLB.Class.extend(i);var s={_slug:"viewer",_refs:{item:"Content_Item",theme:"Theme"},_reciprocal:!0,_attr_default:{loop:!0,animate:!0,autofit:!0,overlay_enabled:!0,overlay_opacity:"0.8",title_default:!1,container:null,slideshow_enabled:!0,slideshow_autostart:!1,slideshow_duration:2,slideshow_active:!1,slideshow_timer:null,image_from_permalink:!1,labels:{close:"close",nav_prev:"&laquo; prev",nav_next:"next &raquo;",slideshow_start:"start slideshow",slideshow_stop:"stop slideshow",group_status:"Image %current% of %total%",loading:"loading"}},_attr_map:{theme:null,group_loop:"loop",ui_autofit:"autofit",ui_animate:"animate",ui_overlay_opacity:"overlay_opacity",ui_labels:"labels",ui_title_default:"title_default",slideshow_enabled:null,slideshow_autostart:null,slideshow_duration:null,image_from_permalink:null},item:null,item_queued:null,theme:null,item_working:null,active:!1,init:!1,open:!1,loading:!1,_hooks:function(){var t=this;this.on(["item-prev","item-next"],function(){t.trigger("item-change")}).on(["close","item-change"],function(){t.unload().done(function(){t.unlock()})})},get_item:function(){return this.get_component("item")},set_item:function(t){this.clear_item(!1);var e=this.set_component("item",t,function(t){return t.has_type()});return!this.util.is_empty(e)},clear_item:function(t){this.util.is_bool(t)||(t=!0);var e=this.get_item();e&&e.reset(),t&&this.clear_component("item")},get_theme:function(){var t=this.get_component("theme",{check_attr:!1});return this.util.is_empty(t)&&(t=this.set_component("theme",new e.Theme(this))),t},set_theme:function(t){this.set_component("theme",t)},lock:function(){return this.set_status("item_working",t.Deferred())},get_lock:function(t,e){this.util.is_bool(t)||(t=!1),this.util.is_bool(e)||(e=!1);var i="item_working";if(t)return this.get_status(i);var s=this.get_status(i,!0);return this.util.is_promise(s)||(s=this.lock()),e?s:s.promise()},is_locked:function(){return this.get_lock(!0)},unlock:function(){return this.get_lock(!1,!0).resolve()},set_active:function(t){return this.util.is_bool(t)||(t=!0),this.set_status("active",t)},is_active:function(){return this.get_status("active")},set_loading:function(e){var i=t.Deferred();this.util.is_bool(e)||(e=!0),this.loading=e,this.slideshow_active()&&this.slideshow_pause(e);var s=e?"addClass":"removeClass";return t(this.dom_get())[s]("loading"),e?this.get_theme().transition("load").always(function(){i.resolve()}):i.resolve(),i.promise()},unset_loading:function(){return this.set_loading(!1)},get_loading:function(){return!!this.util.is_bool(this.loading)&&this.loading},is_loading:function(){return this.get_loading()},show:function(t){this.item_queued=t;var e="show_deferred",i="theme_valid",s=!0;if(this.has_attribute(i)?s=this.get_attribute(i,!0):(s=!!this.get_theme()&&""!==this.get_theme().get_template().get_layout(!1),this.set_attribute(i,s)),!s)return this.close(),!1;var n=this,r=function(){if(n.lock(),n.set_status(e,!1),!n.set_item(n.item_queued))return n.close(),!1;n.history_add(),n.set_active(),n.render()};this.is_locked()?this.get_status(e)||(this.set_status(e),this.get_lock().always(function(){r()})):r()},history_handle:function(t){var e=t.originalEvent.state;if(this.util.is_string(e.item,!1))this.get_controller().get_item(e.item).show({event:t}),this.trigger("item-change");else{var i=this.history_get(!0);this.history_set(0),-1!==i&&this.close()}},history_get:function(t){return this.get_status("history_count",t)},history_set:function(t){return this.set_status("history_count",t)},history_add:function(){if(!history.pushState)return!1;var t=this.get_item(),e=t.get_attribute("options_show"),i=this.history_get()?this.history_get(!0):0;if(this.util.in_obj(e,"event")){var s=e.event.originalEvent;this.util.in_obj(s,"state")&&this.util.in_obj(s.state,"count")&&(i=s.state.count)}else{var n={viewer:this.get_id(),item:null,count:i};i||history.replaceState(n,null),n.item=this.get_controller().save_item(t).get_id(),n.count=++i,history.pushState(n,"")}this.history_set(i)},history_reset:function(){var t=this.history_get(!0);t&&(this.history_set(-1),history.go(-1*t))},is_open:function(){return"none"!==this.dom_get().css("display")},render:function(){var e=this,i=this.get_theme();e.dom_prep(),this.get_status("render-events")||(this.set_status("render-events"),i.on("render-loading",function(i,s){var n=t.Deferred();if(!e.is_active())return n.reject(),n.promise();var r=function(){e.dom_get().css("top",t(window).scrollTop())},u=function(){e.set_loading().always(function(){n.resolve()})};return e.is_open()?s.transition("unload").fail(function(){r(),s.dom_get_tag("item","content").attr("style","")}).always(u):s.transition("open").always(function(){u(),e.events_open(),e.open=!0}).fail(function(){r(),e.get_overlay().show(),e.dom_get().show()}),n.promise()}).on("render-complete",function(i,s){if(!e.is_active())return!1;var n=e.dom_get(),r=["item_single","item_multi"],u=["addClass","removeClass"];e.get_item().get_group().is_single()||u.reverse(),t.each(u,function(t,e){n[e](r[t])}),e.events_complete(),s.transition("complete").fail(function(){if(e.get_attribute("autofit",!0)){var i=t.extend({display:"inline-block"},s.get_item_dimensions());s.dom_get_tag("item","content").css(i)}}).always(function(){e.unset_loading(),e.trigger("render-complete"),e.init=!0})})),i.render()},dom_get_container:function(){var e=this.get_attribute("container");this.util.is_empty(e)&&(e="#"+this.add_ns("wrap"));var i=t(e);if(!i.length){var s=0===e.indexOf("#")?e.substr(1):e;i=t("<div />",{id:s}).appendTo("body")}return i},dom_init:function(){var e=this.dom_set(t("<div/>",{id:this.get_id(!0),class:this.get_ns()})).appendTo(this.dom_get_container()).hide(),i=this.get_theme();e.addClass(i.get_classes(" "));var s=this;this.get_status("render-init")||(this.set_status("render-init"),i.on("render-init",function(t){s.dom_put("layout",t.data)})),i.render(!0)},dom_prep:function(e){var i=this.util.is_bool(e)&&!e?"removeClass":"addClass";t("html")[i](this.util.add_prefix("overlay"))},dom_restore:function(){this.dom_prep(!1)},get_layout:function(){return this.dom_get("layout",{put:{success:function(){t(this).hide()}}})},animation_enabled:function(){return this.get_attribute("animate",!0)},images_uri_mode:function(){return this.get_attribute("images_from_permalink",!0)?"permalink":"source"},overlay_enabled:function(){var t=this.get_attribute("overlay_enabled");return!!this.util.is_bool(t)&&t},get_overlay:function(){var e=null,i=this;return this.overlay_enabled()&&(e=this.dom_get("overlay",{put:{success:function(){t(this).hide().css("opacity",i.get_attribute("overlay_opacity"))}}})),t(e)},unload:function(){var e=t.Deferred();return this.get_theme().dom_get_tag("item").text(""),e.resolve(),e.promise()},reset:function(){this.dom_get().hide(),this.dom_restore(),this.history_reset(),this.clear_item(),this.set_active(!1),this.set_loading(!1),this.slideshow_stop(),this.keys_disable(),this.unlock()},get_labels:function(){return this.get_attribute("labels",{})},get_label:function(t){var e=this.get_labels();return t in e?e[t]:""},events_open:function(){if(this.keys_enable(),this.open)return!1;var t=this.get_layout();t.children().click(function(t){t.stopPropagation()});var e=this,i=function(){e.close()};t.click(i),this.get_overlay().click(i),this.trigger("events-open")},events_complete:function(){if(this.init)return!1;this.trigger("events-complete")},keys_enable:function(e){this.util.is_bool(e)||(e=!0);var i=["keyup",this.util.get_prefix()].join("."),s=this,n=function(t){return s.keys_control(t)};e?t(document).on(i,n):t(document).off(i)},keys_disable:function(){this.keys_enable(!1)},keys_control:function(t){var e={27:this.close,37:this.item_prev,39:this.item_next};if("rtl"===document.documentElement.getAttribute("dir")&&(e[37]=this.item_next,e[39]=this.item_prev),t.which in e)return e[t.which].call(this),!1},slideshow_enabled:function(){var t=this.get_attribute("slideshow_enabled");return!!(this.util.is_bool(t)&&t&&this.get_item())&&!this.get_item().get_group().is_single()},slideshow_active:function(){return!!(this.slideshow_enabled()&&(this.get_attribute("slideshow_active")||!this.init&&this.get_attribute("slideshow_autostart")))},slideshow_clear_timer:function(){clearInterval(this.get_attribute("slideshow_timer"))},slideshow_set_timer:function(t){this.set_attribute("slideshow_timer",setInterval(t,1e3*this.get_attribute("slideshow_duration")))},slideshow_start:function(){if(!this.slideshow_enabled())return!1;this.set_attribute("slideshow_active",!0),this.dom_get().addClass("slideshow_active"),this.slideshow_clear_timer();var t=this;this.slideshow_set_timer(function(){t.slideshow_pause(),t.item_next()}),this.trigger("slideshow-start")},slideshow_stop:function(t){this.util.is_bool(t)||(t=!0),t&&(this.set_attribute("slideshow_active",!1),this.dom_get().removeClass("slideshow_active")),this.slideshow_clear_timer(),this.trigger("slideshow-stop")},slideshow_toggle:function(){if(!this.slideshow_enabled())return!1;this.slideshow_active()?this.slideshow_stop():this.slideshow_start(),this.trigger("slideshow-toggle")},slideshow_pause:function(t){this.util.is_bool(t)||(t=!0),this.slideshow_active()&&(t?this.slideshow_stop(!1):this.slideshow_start()),this.trigger("slideshow-pause")},slideshow_resume:function(){this.slideshow_pause(!1)},item_next:function(){var t=this.get_item().get_group(!0),e=this,i="item-next",s=["events","viewer",i].join("_");t.get_status(s)||(t.set_status(s),t.on(i,function(t){e.trigger(t.type)})),t.show_next()},item_prev:function(){var t=this.get_item().get_group(!0),e=this,i="item-prev",s=["events","viewer",i].join("_");t.get_status(s)||(t.set_status(s),t.on(i,function(){e.trigger(i)})),t.show_prev()},close:function(){this.set_active(!1);var t=this,e=this.get_theme();return e.transition("unload").always(function(){e.transition("close",!0).always(function(){t.reset(),t.trigger("close")})}).fail(function(){e.dom_get_tag("item","content").attr("style","")}),!1}};e.Viewer=i.extend(s);var n={_slug:"group",_reciprocal:!0,_refs:{current:"Content_Item"},current:null,selector:null,_hooks:function(){var t=this;this.on(["item-prev","item-next"],function(){t.trigger("item-change")})},get_selector:function(){return this.util.is_empty(this.selector)&&(this.selector=this.util.format('a[%s="%s"]',this.dom_get_attribute(),this.get_id())),this.selector},get_items:function(){var e=t(this.get_selector());return 0===e.length&&this.has_current()&&(e=this.get_current().dom_get()),e},get_item:function(t){this.util.is_int(t)||(t=0);var e=this.get_items(),i=this.get_size()-1;return t>i&&(t=i),e.get(t)},get_pos:function(t){return this.util.is_empty(t)&&(t=this.get_current()),this.util.is_type(t,e.Content_Item)?this.get_items().index(t.dom_get()):-1},has_current:function(){return!this.util.is_empty(this.get_current())},get_current:function(){return null===this.current||this.util.is_type(this.current,e.Content_Item)||(this.current=null),this.current},set_current:function(t){this.util.is_type(t,e.Content_Item)&&(this.current=t)},get_next:function(t){if(this.util.is_type(t,e.Content_Item)||(t=this.get_current()),1===this.get_size())return t;var i=null,s=this.get_pos(t);return -1!==s&&(0!==(s=s+1<this.get_size()?s+1:0)||t.get_viewer().get_attribute("loop"))&&(i=this.get_item(s)),i},get_prev:function(t){if(this.util.is_type(t,e.Content_Item)||(t=this.get_current()),1===this.get_size())return t;var i=null,s=this.get_pos(t);return -1!==s&&(0!==s||t.get_viewer().get_attribute("loop"))&&(0===s&&(s=this.get_size()),s-=1,i=this.get_item(s)),i},show_next:function(t){if(this.get_size()>1){var i=this.get_next(t);i||(this.util.is_type(t,e.Content_Item)||(t=this.get_current()),t.get_viewer().close());var s=this.get_controller().get_item(i);this.set_current(s),s.show(),this.trigger("item-next")}},show_prev:function(t){if(this.get_size()>1){var i=this.get_prev(t);i||(this.util.is_type(t,e.Content_Item)||(t=this.get_current()),t.get_viewer().close());var s=this.get_controller().get_item(i);this.set_current(s),s.show(),this.trigger("item-prev")}},get_size:function(){return this.get_items().length},is_single:function(){return 1===this.get_size()}};e.Group=i.extend(n),e.Content_Handler=i.extend({_slug:"content_handler",_refs:{item:"Content_Item"},item:null,template:"",has_item:function(){return!this.util.is_empty(this.get_item())},get_item:function(){return this.get_component("item")},set_item:function(t){return this.set_component("item",t)},clear_item:function(){this.clear_component("item")},match:function(t){var e="match",i=this.get_attribute(e);if(!this.util.is_empty(i)){if(this.util.is_string(i)&&(i=RegExp(i,"i"),this.set_attribute(e,i)),this.util.is_type(i,RegExp))return i.test(t.get_uri());if(this.util.is_func(i))return!!i.call(this,t)}return!1},load:function(e){var i=t.Deferred();return null===this.call_attribute("load",e,i)&&i.resolve(),i.promise()},render:function(e){var i=t.Deferred();return this.call_attribute("render",e,i),i.promise()}}),e.Content_Item=i.extend({_slug:"content_item",_reciprocal:!0,_refs:{viewer:"Viewer",group:"Group",type:"Content_Handler"},_attr_default:{source:null,permalink:null,dimensions:null,title:"",group:null,internal:!1,output:null},group:null,viewer:null,type:null,data:null,loaded:null,_c:function(t){this.dom_set(t),this._super()},init_default_attributes:function(){this._super();var e=this.dom_get(),i=e.attr(this.util.get_attribute("asset"))||null,s=this.get_controller().assets||null;if(this.util.is_string(i)){var n,r,u=[{},this._attr_default,{permalink:e.attr("href")}];if(this.util.is_obj(s)){u.push((r={},(n=i)in s&&this.util.is_obj(s[n])&&(r=s[n]),r))}this._attr_default=t.extend.apply(this,u)}return this._attr_default},get_output:function(){var e=t.Deferred(),i=this.get_attribute("output");if(this.util.is_string(i))e.resolve(i);else if(this.has_type()){var s=this.get_type(),n=this;s.render(this).done(function(t){n.set_output(t),e.resolve(t)})}else e.resolve("");return e.promise()},set_output:function(t){this.util.is_string(t,!1)&&this.set_attribute("output",t)},get_content:function(){return this.get_output()},get_uri:function(e){-1===t.inArray(e,["source","permalink"])&&(e=this.get_viewer().images_uri_mode());var i=this.get_attribute(e);return this.util.is_string(i)||(i="source"===e?this.get_attribute("permalink"):""),i=i.replace(/&(#38|amp);/,"&")},get_title:function(){var t="title",e=t+"_cached";if(this.has_attribute(e))return this.get_attribute(e,"");var i="",s=this.dom_get(),n=this,r=function(t){return"string"!=typeof t||""===t.trim()?"":(t=t.trim(),n.get_viewer().get_attribute("title_default")||t===n.get_title_default()&&(t=""),t)};if(s.length&&((i=s.attr(t))||(i=s.closest("figure").find("figcaption").first().html()),i||(i=s.closest("figure").find(".wp-caption-text").first().html())),!i)for(var u=["caption","title"],o=0;o<u.length&&(i=r(this.get_attribute(u[o],"")),this.util.is_empty(i));o++);return i||!s.length||(i=r(s.find("img").first().attr("alt")))||(i=r(s.get(0).innerText.trim())),i=r(i),this.set_attribute(e,i),i},get_title_default:function(){var t="",e="title_default";if(this.has_attribute(e))t=this.get_attribute(e);else{var i=this.get_uri("source"),s=i.lastIndexOf("/");-1!==s&&-1!==(s=(i=i.substr(s+1)).lastIndexOf("."))&&(i=i.substr(0,s)),t=this.set_attribute(e,i)}return t},get_dimensions:function(){return t.extend({width:0,height:0},this.get_attribute("dimensions"),{})},set_data:function(t){this.data=t},get_data:function(){return this.data},gallery_type:function(){var t=null,e={wp:".gallery-icon",ngg:".ngg-gallery-thumbnail"},i=this.dom_get();for(var s in e)if(i.parent(e[s]).length>0){t=s;break}return t},in_gallery:function(t){var e=this.gallery_type();return null!==e&&(!this.util.is_string(t)||t===e)},get_viewer:function(){return this.get_component("viewer",{get_default:!0})},set_viewer:function(t){return this.set_component("viewer",t)},get_group:function(t){var i="group",s=this.get_component(i);return s||(s=this.set_component(i,new e.Group),t=!0),t&&s.set_current(this),s},set_group:function(t){this.util.is_string(t)&&(t=this.get_controller().get_group(t)),this.group=!!this.util.is_type(t,e.Group)&&t},get_type:function(){var t=this.get_component("type",{check_attr:!1});return t||(t=this.set_type(this.get_controller().get_content_handler(this))),t},set_type:function(t){return this.set_component("type",t)},has_type:function(){return!this.util.is_empty(this.get_type())},show:function(t){if(!this.has_type())return!1;this.set_attribute("options_show",t);var e=this.get_viewer();return this.load(),e.show(this)},load:function(){return this.util.is_promise(this.loaded)||(this.loaded=this.get_type().load(this)),this.loaded.promise()},reset:function(){this.set_attribute("options_show",null)}});var r={_slug:"modeled_component",get_attribute:function(t,e,i,s){if(!this.util.is_string(t))return this._super(t,e,s);this.util.is_bool(i)||(i=!0);var n=null;if(i){var r=this.get_ancestor(t,!1);this.util.in_obj(r,t)&&(n=r[t])}return null===n&&(n=this._super(t,e,s)),n},get_attribute_recursive:function(e,i,s){var n=this.get_attribute(e,i,!0,s);if(this.util.is_obj(n)){var r=this.get_ancestors(!1);n=[n];var u=this;t.each(r,function(t,i){e in i&&u.util.is_obj(i[e])&&n.push(i[e])}),n.push({}),n=t.extend.apply(t,n.reverse())}return n},set_attribute:function(t,e,i){return!!(this.util.is_string(t)&&this.util.is_set(e))&&((this.util.is_bool(i)||this.util.is_obj(i)||(i=!0),i)?(this.util.is_obj(i)?i:this.get_model())[t]=e:this._super(t,e),e)},get_model:function(){var t=this.get_attribute("model",null,!1);return this.util.is_obj(t)||(t={},this.set_attribute("model",t,!1)),t},has_model:function(){return!this.util.is_empty(this.get_model())},in_model:function(t){return!!this.util.in_obj(this.get_model(),t)},get_ancestors:function(t){for(var e=[],i=this.get_model();this.util.is_obj(i);)e.push(i),i=this.util.in_obj(i,"parent")&&this.util.is_obj(i.parent)?i.parent:null;return t||e.shift(),e},get_ancestor:function(t,e){if(!this.util.is_string(t))return!1;this.util.is_bool(e)||(e=!0);for(var i=this.get_model(),s=i,n=!1;this.util.is_obj(s);){if(this.util.in_obj(s,t)&&!this.util.is_empty(s[t])){n=!0;break}s=this.util.in_obj(s,"parent")?s.parent:null}return n||(e?(this.util.is_empty(s)&&(s=i),this.util.in_obj(s,t)||(s[t]=null)):s=null),s}};r=i.extend(r);var u={_slug:"theme",_refs:{viewer:"Viewer",template:"Template"},_models:{},_attr_default:{template:null,model:null},viewer:null,template:null,_c:function(t,i,s){1===arguments.length&&this.util.is_type(arguments[0],e.Viewer)&&(s=arguments[0],t=null),this._super(t,i),this.set_viewer(s),this.set_model(t)},get_viewer:function(){return this.get_component("viewer",{check_attr:!1,get_default:!0})},set_viewer:function(t){return this.set_component("viewer",t)},get_template:function(){var t=this.get_component("template");if(this.util.is_empty(t)){var i={theme:this,model:this.get_model()};t=this.set_component("template",new e.Template(i))}return t},get_tags:function(t,e){return this.get_template().get_tags(t,e)},dom_get_tag:function(e,i){return t(this.get_template().dom_get_tag(e,i))},get_tag_selector:function(t,e){return this.get_template().get_tag_selector(t,e)},get_models:function(){return this._models},get_model:function(e){var i=null;if(!this.util.is_set(e)&&this.util.is_obj(this.get_attribute("model",null,!1)))i=this._super();else{var s=this.get_models();this.util.is_string(e)||(e=this.get_controller().get_option("theme_default")),this.util.in_obj(s,e)||(e=t.map(s,function(t,e){return e})[0]),i=s[e]}return i},set_model:function(t){this.set_attribute("model",this.get_model(t),!1)},get_classes:function(e){var i=[],s=this,n=this.get_ancestors(!0);return t.each(n,function(t,e){i.push(s.add_ns(e.id))}),this.util.is_string(e)&&(i=i.join(e)),i},get_measurement:function(e,i){var s=null;if(!this.util.is_string(e))return s;this.util.is_obj(i,!1)||(i={});var n=this.util.format("%s_cache",e),r=this.get_attribute(n,{},!1),u="_status",o=this.get_viewer().get_item(),h=t(window);u in r&&this.util.is_obj(r[u])&&r[u].width===h.width()&&r[u].height===h.height()||(r={}),this.util.is_empty(r)&&(r[u]={width:h.width(),height:h.height(),index:[]});var l=t.inArray(o,r[u].index);return -1!==l&&l in r&&(s=r[l]),this.util.is_obj(s)||(s=this.call_attribute(e),this.util.is_obj(s)||(s=this.get_measurement_default(e))),s=this.util.is_obj(s)?t.extend({},i,s):i,r[l=r[u].index.push(o)-1]=s,this.set_attribute(n,r,!1),t.extend({},s)},get_measurement_default:function(t){return this.util.is_string(t)?(t=this.util.format("get_%s_default",t),this.util.in_obj(this,t)?(t=this[t],this.util.is_func(t)&&(t=t.call(this))):t=null,t):null},get_offset:function(){return this.get_measurement("offset",{width:0,height:0})},get_offset_default:function(){var e={width:0,height:0},i=this.get_viewer(),s=i.dom_get(),n=s.clone().attr("id","").css({visibility:"hidden",position:"absolute",top:""}).removeClass("loading").appendTo(s.parent()),r=n.find(i.dom_get_selector("layout"));if(r.length){r.find("*").css({width:"",height:"",display:""});var u=this.get_tags("item","content");if(u.length){var o=i.get_item().get_dimensions();u=t(r.find(u[0].get_selector("full")).get(0)).css({width:o.width,height:o.height}),t.each(o,function(t,i){e[t]=-1*i})}e.width+=r.width(),e.height+=r.height(),t.each(e,function(t,i){i<0&&(e[t]=0)})}return n.empty().remove(),e},get_margin:function(){return this.get_measurement("margin",{width:0,height:0})},get_item_dimensions:function(){var e=this.get_viewer(),i=e.get_item().get_dimensions();if(e.get_attribute("autofit",!1)){var s=this.get_margin(),n=this.get_offset();n.height+=s.height,n.width+=s.width;var r={width:t(window).width(),height:t(window).height()};r.width>n.width&&(r.width-=n.width),r.height>n.height&&(r.height-=n.height);var u=Math.min(r.width/i.width,r.height/i.height);u<1&&t.each(i,function(t){i[t]=Math.round(i[t]*u)})}return t.extend({},i)},get_dimensions:function(){var e=this.get_item_dimensions(),i=this.get_offset();return t.each(e,function(t){e[t]+=i[t]}),e},get_breakpoints:function(){return this.get_attribute_recursive("breakpoints")},get_breakpoint:function(t){var e=0;if(this.util.is_string(t)){var i=this.get_attribute_recursive("breakpoints");this.util.is_obj(i)&&t in i&&(e=i[t])}return e},render:function(t){var e=this,i=this.get_template(),s="events_render";this.get_status(s)||(this.set_status(s),i.on(["render-init","render-loading","render-complete"],function(t){return e.trigger(t.type,t.data)})),i.render(t)},transition:function(e,i){var s=null,n="transition",r=this.get_viewer(),u=null,o=r.animation_enabled();if(r.get_attribute(n,!0)&&this.util.is_string(e)){var h,l=function(){r.get_layout().find("*").each(function(){for(var e=t(this);e.queue().length;)e.stop(!1,!0)})};i&&l();var a=[n,"set"].join("_");if(this.get_attribute(a))h=this.get_attribute(n,{});else{var g=this.get_ancestors(!0);h=[],this.set_attribute(a,!0);var c=this;t.each(g,function(t,e){n in e&&c.util.is_obj(e[n])&&h.push(e[n])}),h.push({}),h=this.set_attribute(n,t.extend.apply(t,h.reverse()))}this.util.is_method(h,e)&&(o||(u=t.fx.off,t.fx.off=!0),s=h[e].call(this,r,t.Deferred()))}return this.util.is_promise(s)||(s=t.Deferred()).reject(),s.always(function(){null!==u&&(t.fx.off=u)}),s.promise()}};e.Theme=r.extend(u);var o={_slug:"template",_reciprocal:!0,_refs:{theme:"Theme"},_attr_default:{layout_uri:"",layout_raw:"",layout_parsed:"",tags:null,model:null},theme:null,_c:function(t){this._super("",t)},_hooks:function(){this.on("dom_init",function(e){var i=this.get_tags(null,null,!0),s=[],n=this;t.each(i,function(i,r){var u=r.get_name();-1===t.inArray(u,s)&&(s.push(u),r.get_handler().trigger(e.type,{template:n}))})})},get_theme:function(){return this.get_component("theme")},render:function(i){var s=this.get_theme().get_viewer();if(this.util.is_bool(i)||(i=!1),i)this.trigger("render-init",this.dom_get());else{if(!s.is_active())return!1;var n=s.get_item();if(!this.util.is_type(n,e.Content_Item))return s.close(),!1;if(s.is_active()&&this.has_tags()){var r=this.trigger("render-loading"),u=this,o=this.get_tags(),h=[];t.when(n.load(),r).done(function(){return!!s.is_active()&&(t.each(o,function(t,e){if(!s.is_active())return!1;h.push(e.render(n).done(function(t){if(!s.is_active())return!1;t.tag.dom_get().html(t.output)}))}),!!s.is_active()&&void t.when.apply(t,h).done(function(){u.trigger("render-complete")}))})}}},get_layout:function(t){return this.util.is_bool(t)||(t=!0),t?this.parse_layout():this.get_attribute("layout_raw","")},parse_layout:function(){var t="layout_parsed",e=this.get_attribute(t);return this.util.is_string(e)||(e=this.sanitize_layout(this.get_layout(!1)),e=this.parse_tags(e),this.set_attribute(t,e)),e},sanitize_layout:function(e){if(this.util.is_empty(e))return e;var i=this.util.is_string(e)?"string":null,s=t(e),n=this.get_tag_temp(),r=n.get_class(),u=["x",r].join("_");return t(n.get_selector(),s).each(function(){t(this).removeClass(r).addClass(u)}),e="string"===i?s=s.wrap("<div />").parent().html():s},parse_tags:function(t){if(!this.util.is_string(t))return"";for(var e,i=/\{{2}\s*(\w.*?)\s*\}{2}/gim;e=i.exec(t);)t=t.substring(0,e.index)+this.get_tag_container(e[1])+t.substring(e.index+e[0].length);return t},get_tag_container:function(t){var e=this.get_tag_attribute();return this.util.format('<span %s="%s"></span>',e,encodeURI(t))},get_tag_attribute:function(){return this.get_tag_temp().dom_get_attribute()},get_tag:function(t){var e=null;if(this.has_tags()){var i=this.get_tags();(!this.util.is_int(t)||0>t||t>=i.length)&&(t=0),e=i[t]}return e},get_tags:function(i,s,n){this.util.is_bool(n)||(n=!1);var r="tags",u=this.get_attribute(r);if(!this.util.is_array(u)){u=[];var o=this.dom_get(),h=this.get_tag_attribute(),l=t(o).find("["+h+"]");t(l).each(function(){var i=t(this),s=new e.Template_Tag(decodeURI(i.attr(h)));s.has_handler()&&(u.push(s),n||(s.dom_set(i),i.addClass(s.get_classes(" ")))),n||i.removeAttr(h)}),n||this.set_attribute(r,u,!1)}if(!this.util.is_empty(u)&&this.util.is_string(i)){this.util.is_string(s)||(s=!1);for(var a=[],g=null,c=0;c<u.length;c++)i!==(g=u[c]).get_name()||s&&s!==g.get_prop()||a.push(g);u=a}return this.util.is_array(u,!1)?u:[]},has_tags:function(){return this.get_tags().length>0},get_tag_temp:function(){return this.get_controller().get_component_temp(e.Template_Tag)},get_tag_selector:function(t,e){this.util.is_string(t)||(t=""),this.util.is_string(e)||(e="");var i=this.get_tag_temp();return i.set_attribute("name",t),i.set_attribute("prop",e),i.get_selector("full")},dom_init:function(){this.dom_set(this.get_layout()),this.trigger("dom_init")},dom_get_tag:function(e,i){var s=t(),n=this.get_tags(e,i);if(n.length){var r=null;this.util.is_string(e)&&(r=this.util.is_string(i)?"full":"tag");var u="."+n[0].get_class(r);s=this.dom_get().find(u)}return s}};e.Template=r.extend(o),e.Template_Tag=i.extend({_slug:"template_tag",_reciprocal:!0,_attr_default:{name:null,prop:null,match:null},handlers:{},_c:function(t){this.parse(t)},parse:function(t){if(!this.util.is_string(t))return!1;var e,i=t.split("|");if(!i.length)return null;var s={name:null,prop:null,match:t};s.name=i[0],-1!==s.name.indexOf(".")&&(s.name=s.name.split(".",2),s.prop=s.name[1],s.name=s.name[0]);for(var n=1;n<i.length;n++)!((e=i[n].split(":",1)).length>1)||e[0]in s||(s[e[0]]=e[1]);this.set_attributes(s,!0)},render:function(t){var e=this;return e.get_handler().render(t,e).pipe(function(t){return{tag:e,output:t}})},get_name:function(){return this.get_attribute("name")},get_prop:function(){return this.get_attribute("prop")},get_handler:function(){return this.has_handler()?this.handlers[this.get_name()]:new e.Template_Tag_Handler("")},has_handler:function(){return this.get_name() in this.handlers},get_classes:function(t){var e=[this.get_class(),this.get_class("tag"),this.get_class("full")];return this.util.is_string(t)&&(e=e.join(t)),e},get_class:function(t){var e="";switch(t){case"tag":e=this.get_name();break;case"full":var i,s=[this.get_name(),this.get_prop()],n=[];for(i=0;i<s.length;i++)this.util.is_string(s[i])&&n.push(s[i]);e=n.join("_")}return this.util.is_string(e)?this.add_ns(e):this.get_ns()},get_selector:function(t){var e=this.get_class(t);return this.util.is_string(e)?"."+e:""}}),e.Template_Tag_Handler=i.extend({_slug:"template_tag_handler",_attr_default:{supports_modifiers:!1,dynamic:!1,props:{}},render:function(e,i){var s=t.Deferred();return this.call_attribute("render",e,i,s),s.promise()},add_prop:function(t,e){var i="props",s=this.get_attribute(i);if(!this.util.is_string(t)||!this.util.is_func(e))return!1;this.util.is_obj(s,!1)||(s={}),s[t]=e,this.set_attribute(i,s)},handle_prop:function(t,e,i){var s=this.get_attribute("props"),n="";return this.util.is_obj(s)&&t in s&&this.util.is_func(s[t])?s[t].call(this,e,i):e.get_viewer().get_label(t)}}),e=SLB.attach("View",e)}(jQuery);